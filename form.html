<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Заполнение расписания</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Заполнение расписания</h1>
    </header>

    <main>
        <form id="scheduleForm">
            <!-- Форма аналогична той, что в index.html -->
            <div class="form-control">
                <label for="className">Выберите класс:</label>
                <select id="className">
                    <option value="5а">5а</option>
                    <option value="5б">5б</option>
                    <option value="5в">5в</option>
                    <option value="5г">5г</option>
                    <option value="6а">6а</option>
                    <option value="6б">6б</option>
                    <option value="6в">6в</option>
                    <option value="7а">7а</option>
                    <option value="7б">7б</option>
                    <option value="8а">8а</option>
                    <option value="9а">9а</option>
                    <option value="10ен">10ен</option>
                    <option value="11ен">11ен</option>
                </select>
            </div>

            <div class="form-control">
                <label for="teacher">Выберите учителя:</label>
                <select id="teacher">
                    <option value="Иванова И.И.">Иванова И.И.</option>
                    <option value="Петров П.П.">Петров П.П.</option>
                    <option value="Сидорова С.С.">Сидорова С.С.</option>
                </select>
            </div>

            <div class="form-control">
                <label for="lessonNumber">Выберите номер урока:</label>
                <select id="lessonNumber">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                </select>
            </div>

            <div class="form-control">
                <label for="subject">Введите предмет:</label>
                <input type="text" id="subject" placeholder="Математика, Русский и т.д." required>
            </div>

            <div class="form-control">
                <label for="absence">Если урока нет, выберите:</label>
                <select id="absence">
                    <option value="">Урок присутствует</option>
                    <option value="окно">Окно</option>
                </select>
            </div>

            <button type="submit">Сохранить расписание</button>
        </form>
    </main>

    <script>
        const scheduleUrl = 'https://gist.githubusercontent.com/3-School-Achinsk/4b7c67ffb92982bfebd3511f702756e3/raw/79bf1323d0336531e9fc5cd7db016078da34b85a/schedules.json'; // Ваш Raw URL

        document.getElementById('scheduleForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            // Получаем значения
            const className = document.getElementById('className').value;
            const subject = document.getElementById('subject').value;
            const lessonNumber = document.getElementById('lessonNumber').value;
            const teacher = document.getElementById('teacher').value;
            const absence = document.getElementById('absence').value;

            // Получение текущих данных
            const response = await fetch(scheduleUrl);
            const data = await response.json();

            // Обновление расписания
            if (absence === "окно") {
                data[className] = data[className] || [];
                data[className][lessonNumber - 1] = `${lessonNumber} Окно`;
            } else {
                const lessonEntry = `${lessonNumber} ${subject}, ${teacher}`;
                data[className] = data[className] || [];
                data[className][lessonNumber - 1] = lessonEntry;
            }

            // Сохранение расписания
            await fetch('https://api.github.com/gists/4b7c67ffb92982bfebd3511f702756e3', {
                method: 'PATCH',
                headers: {
                    'Authorization': 'token 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', // Замените на ваш токен
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    files: {
                        'schedules.json': {
                            content: JSON.stringify(data, null, 2)
                        }
                    }
                })
            });

            alert('Расписание сохранено!');
            document.getElementById('scheduleForm').reset();
        });
    </script>
</body>
</html>
